<div class="highlight"><pre><span></span><span class="o">#[</span><span class="n">global</span><span class="o">]</span>
<span class="kn">Instance</span> <span class="n">Proper_f</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">((==)</span> <span class="o">==&gt;</span> <span class="o">(==))</span> <span class="n">f</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Class</span> <span class="n">PER</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">PER_symmetry</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">R</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">R</span> <span class="n">y</span> <span class="n">x</span>
  <span class="o">;</span> <span class="n">PER_transitivity</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">R</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">R</span> <span class="n">y</span> <span class="n">z</span> <span class="o">-&gt;</span> <span class="n">R</span> <span class="n">x</span> <span class="n">z</span> <span class="o">}.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Definition</span> <span class="n">R</span> <span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="k">forall</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≈</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">≈</span> <span class="n">g</span> <span class="n">y</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="c">(* In the standard library: From Coq Require Import Morphisms *)</span>
<span class="kn">Class</span> <span class="n">Proper</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
  <span class="n">proper_prf</span> <span class="o">:</span> <span class="n">R</span> <span class="n">x</span> <span class="n">x</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Theorem</span> <span class="n">Prim_and_Proper</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">PER</span> <span class="n">R</span> <span class="o">-&gt;</span>
  <span class="k">forall</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="n">R</span> <span class="n">x</span> <span class="n">x</span> <span class="o">&lt;-&gt;</span> <span class="k">exists</span> <span class="n">y</span><span class="o">,</span> <span class="n">R</span> <span class="n">x</span> <span class="n">y</span><span class="o">).</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="c">(* In the standard library: From Coq Require Import Morphisms *)</span>
<span class="kn">Definition</span> <span class="n">respectful</span> <span class="o">{</span><span class="n">D</span><span class="o">}</span> <span class="o">(</span><span class="n">RD</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span>
                      <span class="o">{</span><span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">RC</span> <span class="o">:</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span>
    <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
  <span class="k">forall</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">RD</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">RC</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="n">y</span><span class="o">).</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Notation</span> <span class="s2">&quot;f ==&gt; g&quot;</span> <span class="o">:=</span> <span class="o">(</span><span class="n">respectful</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="o">(</span><span class="k">right</span> <span class="n">associativity</span><span class="o">,</span> <span class="n">at</span> <span class="n">level</span> <span class="mi">55</span><span class="o">)</span>
  <span class="o">:</span> <span class="n">signature_scope</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="o">(</span><span class="n">RE</span> <span class="o">==&gt;</span> <span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="n">f</span> <span class="n">g</span>
<span class="o">&lt;-&gt;</span>
<span class="k">forall</span> <span class="n">s</span> <span class="n">t</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">RE</span> <span class="n">s</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">RD</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">RC</span> <span class="o">(</span><span class="n">f</span> <span class="n">s</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="n">t</span> <span class="n">y</span><span class="o">)</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="n">Proper</span> <span class="o">:</span> <span class="o">(</span><span class="n">A</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="k">forall</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">RD</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">RC</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">y</span><span class="o">)</span>
<span class="o">=</span>
<span class="n">respectful</span> <span class="n">RD</span> <span class="n">RC</span> <span class="n">f</span> <span class="n">f</span>
<span class="o">=</span>
<span class="o">(</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="n">f</span> <span class="n">f</span>
<span class="o">=</span>
<span class="n">Proper</span> <span class="o">(</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="n">f</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Definition</span> <span class="n">iff</span> <span class="o">(</span><span class="n">P</span> <span class="n">Q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">(</span><span class="n">P</span> <span class="o">-&gt;</span> <span class="n">Q</span><span class="o">)</span> <span class="o">/\</span> <span class="o">(</span><span class="n">Q</span> <span class="o">-&gt;</span> <span class="n">P</span><span class="o">).</span>
<span class="kn">Notation</span> <span class="s2">&quot;P &lt;-&gt; Q&quot;</span> <span class="o">:=</span> <span class="o">(</span><span class="n">iff</span> <span class="n">P</span> <span class="n">Q</span><span class="o">).</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="n">Proper</span> <span class="o">(</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">iff</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">P</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">))</span>
<span class="o">=</span>
<span class="k">forall</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">RD</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">P</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">&lt;-&gt;</span> <span class="n">P</span> <span class="o">(</span><span class="n">f</span> <span class="n">y</span><span class="o">)</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="c">(* In the standard library: From Coq Require Import Morphisms *)</span>
<span class="c">(* The domain D is not implicit in the standard library. *)</span>
<span class="kn">Definition</span> <span class="n">pointwise_relation</span> <span class="o">{</span><span class="n">D</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">RC</span> <span class="o">:</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span>
    <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
  <span class="k">forall</span> <span class="n">x</span><span class="o">,</span> <span class="n">RC</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="n">x</span><span class="o">).</span>

<span class="c">(* Abbreviation (not in the stdlib) *)</span>
<span class="kn">Notation</span> <span class="n">pr</span> <span class="o">:=</span> <span class="n">pointwise_relation</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="o">#[</span><span class="n">global</span><span class="o">]</span>
<span class="kn">Instance</span> <span class="n">Proper_f</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">(</span><span class="n">pointwise_relation</span> <span class="n">RF</span> <span class="o">==&gt;</span> <span class="n">RD</span><span class="o">)</span> <span class="n">f</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Definition</span> <span class="n">compose</span> <span class="o">{</span><span class="n">E</span> <span class="n">D</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">E</span> <span class="o">-&gt;</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">E</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">:=</span>
  <span class="k">fun</span> <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">f</span> <span class="o">(</span><span class="n">g</span> <span class="n">x</span><span class="o">).</span>

<span class="kn">Theorem</span> <span class="n">not_Proper_compose</span> <span class="o">:</span>
  <span class="n">not</span>
   <span class="o">(</span><span class="k">forall</span> <span class="o">{</span><span class="n">E</span> <span class="n">D</span> <span class="n">C</span><span class="o">}</span>
           <span class="o">(</span><span class="n">RD</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">RC</span> <span class="o">:</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">),</span>
    <span class="n">Proper</span> <span class="o">(</span><span class="n">pr</span> <span class="n">RC</span> <span class="o">==&gt;</span> <span class="n">pr</span> <span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">pr</span> <span class="n">RC</span><span class="o">)</span>
           <span class="o">(</span><span class="n">compose</span> <span class="o">(</span><span class="n">E</span> <span class="o">:=</span> <span class="n">E</span><span class="o">))).</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="o">#[</span><span class="n">global</span><span class="o">]</span>
<span class="kn">Instance</span> <span class="n">Proper_compose</span> <span class="o">{</span><span class="n">E</span> <span class="n">D</span> <span class="n">C</span><span class="o">}</span>
    <span class="o">(</span><span class="n">RD</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">RC</span> <span class="o">:</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">Proper</span> <span class="o">((</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="n">pr</span> <span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">pr</span> <span class="n">RC</span><span class="o">)</span>
           <span class="o">(</span><span class="n">compose</span> <span class="o">(</span><span class="n">E</span> <span class="o">:=</span> <span class="n">E</span><span class="o">)).</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="o">#[</span><span class="n">global</span><span class="o">]</span>
<span class="kn">Instance</span> <span class="n">Proper_compose&#39;</span> <span class="o">{</span><span class="n">E</span> <span class="n">D</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">RE</span> <span class="o">:</span> <span class="n">E</span> <span class="o">-&gt;</span> <span class="n">E</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span>
    <span class="o">(</span><span class="n">RD</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">RC</span> <span class="o">:</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">Proper</span> <span class="o">((</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="n">RE</span> <span class="o">==&gt;</span> <span class="n">RD</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="n">RE</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">))</span>
           <span class="n">compose</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Theorem</span> <span class="n">pointwise_respectful</span> <span class="o">{</span><span class="n">D</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">RD</span> <span class="o">:</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">RC</span> <span class="o">:</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span>
  <span class="o">:</span> <span class="n">Reflexive</span> <span class="n">RD</span> <span class="o">-&gt;</span> <span class="n">Transitive</span> <span class="n">RC</span> <span class="o">-&gt;</span>
    <span class="k">forall</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">Proper</span> <span class="o">(</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="n">Proper</span> <span class="o">(</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="n">g</span> <span class="o">-&gt;</span>
    <span class="n">pointwise_relation</span> <span class="n">RC</span> <span class="n">f</span> <span class="n">g</span> <span class="o">&lt;-&gt;</span> <span class="o">(</span><span class="n">RD</span> <span class="o">==&gt;</span> <span class="n">RC</span><span class="o">)</span> <span class="n">f</span> <span class="n">g</span><span class="o">.</span>
</pre></div>

<!-- pygments-batch-end -->
<div class="highlight"><pre><span></span><span class="kn">Definition</span> <span class="n">RID</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="k">forall</span> <span class="n">A</span><span class="o">,</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
  <span class="k">forall</span> <span class="n">A</span> <span class="o">(</span><span class="n">RA</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">),</span> <span class="o">(</span><span class="n">RA</span> <span class="o">==&gt;</span> <span class="n">RA</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="n">A</span><span class="o">).</span>
</pre></div>

<!-- pygments-batch-end -->
